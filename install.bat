@echo off
echo ================================================
echo  Satisfactory Calculator Pro - ??????????????????
echo ================================================
echo.

REM ???????????????????? ?????????? ??????????????????
set "INSTALL_DIR=%PROGRAMFILES%\SatisfactoryCalculatorPro"
if not exist "%INSTALL_DIR%" mkdir "%INSTALL_DIR%"

echo ?????????????????? ??: %INSTALL_DIR%
echo.

REM ???????????????? ??????????
echo ?????????????????????? ????????????...
xcopy /E /Y /Q "%~dp0portable\*" "%INSTALL_DIR%\"

REM ?????????????? ?????????? ???? ?????????????? ??????????
echo ???????????????? ???????????? ???? ?????????????? ??????????...
powershell -Command "& {$ws = New-Object -ComObject WScript.Shell; $s = $ws.CreateShortcut('%USERPROFILE%\Desktop\Satisfactory Calculator Pro.lnk'); $s.TargetPath = '%INSTALL_DIR%\SatisCalculator.exe'; $s.WorkingDirectory = '%INSTALL_DIR%'; $s.Description = 'Professional production chain calculator for Satisfactory'; $s.Save()}"

REM ?????????????? ?????????? ?? ???????? ????????
echo ???????????????? ???????????? ?? ???????? ????????...
if not exist "%APPDATA%\Microsoft\Windows\Start Menu\Programs\Satisfactory Calculator Pro" mkdir "%APPDATA%\Microsoft\Windows\Start Menu\Programs\Satisfactory Calculator Pro"
powershell -Command "& {$ws = New-Object -ComObject WScript.Shell; $s = $ws.CreateShortcut('%APPDATA%\Microsoft\Windows\Start Menu\Programs\Satisfactory Calculator Pro\Satisfactory Calculator Pro.lnk'); $s.TargetPath = '%INSTALL_DIR%\SatisCalculator.exe'; $s.WorkingDirectory = '%INSTALL_DIR%'; $s.Description = 'Professional production chain calculator for Satisfactory'; $s.Save()}"

REM ?????????????? ??????????????????????????
echo ???????????????? ????????????????????????????...
echo @echo off > "%INSTALL_DIR%\Uninstall.bat"
echo echo ???????????????? Satisfactory Calculator Pro... >> "%INSTALL_DIR%\Uninstall.bat"
echo rmdir /s /q "%INSTALL_DIR%" >> "%INSTALL_DIR%\Uninstall.bat"
echo del "%USERPROFILE%\Desktop\Satisfactory Calculator Pro.lnk" 2^>nul >> "%INSTALL_DIR%\Uninstall.bat"
echo rmdir /s /q "%APPDATA%\Microsoft\Windows\Start Menu\Programs\Satisfactory Calculator Pro" 2^>nul >> "%INSTALL_DIR%\Uninstall.bat"
echo echo ???????????????? ??????????????????! >> "%INSTALL_DIR%\Uninstall.bat"
echo pause >> "%INSTALL_DIR%\Uninstall.bat"

REM ???????????????????????? ?? Programs and Features
echo ?????????????????????? ?? Programs and Features...
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\SatisfactoryCalculatorPro" /v DisplayName /t REG_SZ /d "Satisfactory Calculator Pro" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\SatisfactoryCalculatorPro" /v DisplayVersion /t REG_SZ /d "1.0.0" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\SatisfactoryCalculatorPro" /v Publisher /t REG_SZ /d "SatisCalc Team" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\SatisfactoryCalculatorPro" /v InstallLocation /t REG_SZ /d "%INSTALL_DIR%" /f
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\SatisfactoryCalculatorPro" /v UninstallString /t REG_SZ /d "%INSTALL_DIR%\Uninstall.bat" /f

echo.
echo ================================================
echo  ?????????????????? ?????????????????? ??????????????!
echo ================================================
echo.
echo ???????????????????? ?????????????????????? ??: %INSTALL_DIR%
echo ???????????? ?????????????? ???? ?????????????? ?????????? ?? ?? ???????? ????????
echo.
echo ?????????????????? ???????????????????? ????????????? (y/n)
choice /c yn /n
if errorlevel 2 goto :end
if errorlevel 1 start "" "%INSTALL_DIR%\SatisCalculator.exe"

:end
echo.
echo ????????????!
pause
